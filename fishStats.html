<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>fishStats.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!DOCTYPE html>
<head>
<!-- Favicon for various operating systems -->
<link rel="apple-touch-icon" sizes="180x180" href="./favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon/favicon-16x16.png">
<!-- <link rel="manifest" href="./favicon/site.webmanifest"> -->
<link rel="mask-icon" href="./favicon/safari-pinned-tab.svg" color="#603cba">
<link rel="shortcut icon" href="./favicon/favicon.ico">
<meta name="msapplication-TileColor" content="#603cba">
<meta name="msapplication-config" content="./favicon/browserconfig.xml">
<meta name="theme-color" content="#382121">
</head>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">We R NYCAFS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="software.html">Before the workshops</a>
</li>
<li>
  <a href="content.html">Workshop modules</a>
</li>
<li>
  <a href="resources.html">Additional Resources</a>
</li>
<li>
  <a href="contact.html">Contact</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://www.youtube.com/channel/UCB1l-SSnpD7ndeNe7Fbg4_g">
    <span class="fa fa-youtube"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/danStich/we-r-nycafs">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="introductory-fisheries-statistics-in-r" class="section level1">
<h1>Introductory fisheries statistics in R</h1>
<p><img src="images/logo.png" alt=""></p>
<h2 id="multi">
Introduction
</h2>
<p>Now that we have looked at some of the basic programming and common statistical tools in R, we can dive into some of the tools that have been created just for fish! There are a few packages for dealing with data from fish and fisheries, and we will just glance off the tip of the iceberg here to demonstrate a few common fisheries analyses. Hopefully you find, like many of us, that once you’ve tackled the code the first time it is easy to translate from one species or data set to another. And next time, you’ll have a head-start!</p>
<p>For this workshop, we will continue to work with <code>tidyverse</code> for data manipulation and plotting, and we’ll use the <code>FSA</code> package <a href="https://derekogle.com/fishR/">Ogle et al. 2020</a> for some fisheries-specific functions that should free up some time in your daily routine. We’ll need the <code>nlstools</code> package to make predictions from growth curves we’ll fit with <code>nls()</code>. And, we will use the <code>plotrix</code> package to plot some of our <code>FSA</code> output. You’ll need to install these packages first if you haven’t already. If you are working in RStudio, you probably got a prompt to install them when you opened the workshop script called <code>fishStats.R</code> if you’ve never worked with them before.</p>
<p>You can load all of these packages when you are ready to get started:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(FSA)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(nlstools)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(plotrix)</span></code></pre></div>
<div id="length-frequency-histograms" class="section level2">
<h2>Length-frequency histograms</h2>
<h3 id="multi">
Doing it ‘by hand’
</h3>
<p>Let’s start by reading in some grass carp (<em>Ctenopharyngodon idella</em>) data from Lake Gaston, a large reservoir on the border of North Carolina and Virginia in the heartland of contemporary triploid grass carp population dynamics (hey, it’s a thing!). The data contain information about <code>year</code> of collection (2006, 2007, 2009, 2010, and 2017), total length (<code>tl</code>), mass (<code>kg</code>), and <code>age</code> assigned from otoliths for each of 419 individual <code>fish</code> in <code>cohorts</code>(1994 - 2014). It also includes information about modeled number of grass carp (<code>n_gc</code>), estimated hectares of hydrilla (<code>ha_hydrilla</code>), and number and biomass of grass carp per hectare of hydrilla. These data are from a <a href="https://github.com/danStich/grasscarp">recent analysis</a> by a former New York Chapter AFS member and MS Lake Management student at SUNY Oneonta <a href="https://afspubs.onlinelibrary.wiley.com/doi/abs/10.1002/nafm.10515">Caves et al. In press</a>. If you are a member of <a href="https://fisheries.org/">American Fisheries Society</a> you have access to the early view of that article. Just sayin…</p>
<p>Shameless, I know, just read in the data file:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>grasscarp &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/grasscarp.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>Have a quick look at the first ten lines of the data</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">head</span>(grasscarp, <span class="dv">10</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>   year   tl   kg age cohort  n_gc ha_hydrilla n_ha  kg_gc kg_ha</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="dv">1</span>  <span class="dv">2006</span> <span class="dv">1262</span> <span class="fl">23.2</span>  <span class="dv">12</span>   <span class="dv">1994</span> <span class="dv">25128</span>        <span class="dv">1203</span>   <span class="dv">21</span> <span class="dv">129929</span>   <span class="dv">108</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="dv">2</span>  <span class="dv">2006</span>  <span class="dv">569</span>  <span class="fl">2.7</span>   <span class="dv">2</span>   <span class="dv">2004</span> <span class="dv">25128</span>        <span class="dv">1203</span>   <span class="dv">21</span> <span class="dv">129929</span>   <span class="dv">108</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="dv">3</span>  <span class="dv">2006</span>  <span class="dv">504</span>  <span class="fl">2.2</span>   <span class="dv">2</span>   <span class="dv">2004</span> <span class="dv">25128</span>        <span class="dv">1203</span>   <span class="dv">21</span> <span class="dv">129929</span>   <span class="dv">108</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="dv">4</span>  <span class="dv">2006</span>  <span class="dv">846</span>  <span class="fl">8.0</span>   <span class="dv">3</span>   <span class="dv">2003</span> <span class="dv">25128</span>        <span class="dv">1203</span>   <span class="dv">21</span> <span class="dv">129929</span>   <span class="dv">108</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="dv">5</span>  <span class="dv">2006</span> <span class="dv">1138</span> <span class="fl">23.9</span>  <span class="dv">10</span>   <span class="dv">1996</span> <span class="dv">25128</span>        <span class="dv">1203</span>   <span class="dv">21</span> <span class="dv">129929</span>   <span class="dv">108</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="dv">6</span>  <span class="dv">2006</span> <span class="dv">1187</span> <span class="fl">18.6</span>  <span class="dv">10</span>   <span class="dv">1996</span> <span class="dv">25128</span>        <span class="dv">1203</span>   <span class="dv">21</span> <span class="dv">129929</span>   <span class="dv">108</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="dv">7</span>  <span class="dv">2006</span> <span class="dv">1207</span> <span class="fl">19.5</span>  <span class="dv">12</span>   <span class="dv">1994</span> <span class="dv">25128</span>        <span class="dv">1203</span>   <span class="dv">21</span> <span class="dv">129929</span>   <span class="dv">108</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="dv">8</span>  <span class="dv">2006</span> <span class="dv">1086</span> <span class="fl">21.3</span>  <span class="dv">10</span>   <span class="dv">1996</span> <span class="dv">25128</span>        <span class="dv">1203</span>   <span class="dv">21</span> <span class="dv">129929</span>   <span class="dv">108</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="dv">9</span>  <span class="dv">2006</span>  <span class="dv">525</span>  <span class="fl">2.9</span>   <span class="dv">2</span>   <span class="dv">2004</span> <span class="dv">25128</span>        <span class="dv">1203</span>   <span class="dv">21</span> <span class="dv">129929</span>   <span class="dv">108</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="dv">10</span> <span class="dv">2006</span>  <span class="dv">837</span>  <span class="fl">8.2</span>   <span class="dv">4</span>   <span class="dv">2002</span> <span class="dv">25128</span>        <span class="dv">1203</span>   <span class="dv">21</span> <span class="dv">129929</span>   <span class="dv">108</span></span></code></pre></div>
<p>Take a quick look at the data structure</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">str</span>(grasscarp)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="st">&#39;data.frame&#39;</span><span class="op">:</span><span class="st">   </span><span class="dv">419</span> obs. of  <span class="dv">10</span> variables<span class="op">:</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="st"> </span><span class="er">$</span><span class="st"> </span>year       <span class="op">:</span><span class="st"> </span>int  <span class="dv">2006</span> <span class="dv">2006</span> <span class="dv">2006</span> <span class="dv">2006</span> <span class="dv">2006</span> <span class="dv">2006</span> <span class="dv">2006</span> <span class="dv">2006</span> <span class="dv">2006</span> <span class="dv">2006</span> ...</span>
<span id="cb4-4"><a href="#cb4-4"></a> <span class="op">$</span><span class="st"> </span>tl         <span class="op">:</span><span class="st"> </span>int  <span class="dv">1262</span> <span class="dv">569</span> <span class="dv">504</span> <span class="dv">846</span> <span class="dv">1138</span> <span class="dv">1187</span> <span class="dv">1207</span> <span class="dv">1086</span> <span class="dv">525</span> <span class="dv">837</span> ...</span>
<span id="cb4-5"><a href="#cb4-5"></a> <span class="op">$</span><span class="st"> </span>kg         <span class="op">:</span><span class="st"> </span>num  <span class="fl">23.2</span> <span class="fl">2.7</span> <span class="fl">2.2</span> <span class="dv">8</span> <span class="fl">23.9</span> <span class="fl">18.6</span> <span class="fl">19.5</span> <span class="fl">21.3</span> <span class="fl">2.9</span> <span class="fl">8.2</span> ...</span>
<span id="cb4-6"><a href="#cb4-6"></a> <span class="op">$</span><span class="st"> </span>age        <span class="op">:</span><span class="st"> </span>int  <span class="dv">12</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">10</span> <span class="dv">10</span> <span class="dv">12</span> <span class="dv">10</span> <span class="dv">2</span> <span class="dv">4</span> ...</span>
<span id="cb4-7"><a href="#cb4-7"></a> <span class="op">$</span><span class="st"> </span>cohort     <span class="op">:</span><span class="st"> </span>int  <span class="dv">1994</span> <span class="dv">2004</span> <span class="dv">2004</span> <span class="dv">2003</span> <span class="dv">1996</span> <span class="dv">1996</span> <span class="dv">1994</span> <span class="dv">1996</span> <span class="dv">2004</span> <span class="dv">2002</span> ...</span>
<span id="cb4-8"><a href="#cb4-8"></a> <span class="op">$</span><span class="st"> </span>n_gc       <span class="op">:</span><span class="st"> </span>int  <span class="dv">25128</span> <span class="dv">25128</span> <span class="dv">25128</span> <span class="dv">25128</span> <span class="dv">25128</span> <span class="dv">25128</span> <span class="dv">25128</span> <span class="dv">25128</span> <span class="dv">25128</span> <span class="dv">25128</span> ...</span>
<span id="cb4-9"><a href="#cb4-9"></a> <span class="op">$</span><span class="st"> </span>ha_hydrilla<span class="op">:</span><span class="st"> </span>int  <span class="dv">1203</span> <span class="dv">1203</span> <span class="dv">1203</span> <span class="dv">1203</span> <span class="dv">1203</span> <span class="dv">1203</span> <span class="dv">1203</span> <span class="dv">1203</span> <span class="dv">1203</span> <span class="dv">1203</span> ...</span>
<span id="cb4-10"><a href="#cb4-10"></a> <span class="op">$</span><span class="st"> </span>n_ha       <span class="op">:</span><span class="st"> </span>int  <span class="dv">21</span> <span class="dv">21</span> <span class="dv">21</span> <span class="dv">21</span> <span class="dv">21</span> <span class="dv">21</span> <span class="dv">21</span> <span class="dv">21</span> <span class="dv">21</span> <span class="dv">21</span> ...</span>
<span id="cb4-11"><a href="#cb4-11"></a> <span class="op">$</span><span class="st"> </span>kg_gc      <span class="op">:</span><span class="st"> </span>int  <span class="dv">129929</span> <span class="dv">129929</span> <span class="dv">129929</span> <span class="dv">129929</span> <span class="dv">129929</span> <span class="dv">129929</span> <span class="dv">129929</span> <span class="dv">129929</span> <span class="dv">129929</span> <span class="dv">129929</span> ...</span>
<span id="cb4-12"><a href="#cb4-12"></a> <span class="op">$</span><span class="st"> </span>kg_ha      <span class="op">:</span><span class="st"> </span>int  <span class="dv">108</span> <span class="dv">108</span> <span class="dv">108</span> <span class="dv">108</span> <span class="dv">108</span> <span class="dv">108</span> <span class="dv">108</span> <span class="dv">108</span> <span class="dv">108</span> <span class="dv">108</span> ...</span></code></pre></div>
<p>Don’t forget, you can even look at it like a spreadsheet!</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">View</span>(grasscarp)</span></code></pre></div>
<p>Now, let’s make a basic l-f histogram of the grasscarp data. (You’ll get some constructive feedback from <code>stat_bin()</code> in <code>ggplot2</code> about this. You can ignore it or use <code>geom_hist(bins = 25)</code> if it really bothers you.)</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Make a histogram with all of the arguments set to their defaults</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">ggplot</span>(grasscarp, <span class="kw">aes</span>(tl)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>()</span></code></pre></div>
<p><img src="fishStats_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>This is pretty ugly, and it doesn’t do a whole lot for us in terms of biological meaning. We can modify this plot to use standard <code>breaks</code> so that we can get, for example, 10-mm length bins that may have more biological meaning for fisheries management.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Make a histogram with 10-mm size bins</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">ggplot</span>(grasscarp, <span class="kw">aes</span>(<span class="dt">x =</span> tl)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="fishStats_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Wow, that is way easier than it used to be even in R. Thanks <code>ggplot()</code>!</p>
<p>Okay, so this plot is better, but there is still a lot of ugly crap going on here. For one, the labels make no sense. The axes don’t cross at zero, we have no color, and we have an ugly main heading in our figure that we will virtually never use for papers or reports.</p>
<p>So, let’s fix it!!</p>
<p>First, let’s make a better looking histogram “by hand”.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Make a histogram with 10-mm size bins</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co"># But, make it pretty this time</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="kw">ggplot</span>(grasscarp, <span class="kw">aes</span>(<span class="dt">x =</span> tl)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>) <span class="op">+</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Total length (mm)&quot;</span>) <span class="op">+</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Frequency&quot;</span>) <span class="op">+</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">15</span>), <span class="dt">expand =</span> <span class="kw">c</span>(<span class="fl">0.01</span>, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb8-10"><a href="#cb8-10"></a>    <span class="dt">axis.title.x =</span> <span class="kw">element_text</span>(<span class="dt">vjust =</span> <span class="dv">-1</span>),</span>
<span id="cb8-11"><a href="#cb8-11"></a>    <span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">vjust =</span> <span class="dv">3</span>)</span>
<span id="cb8-12"><a href="#cb8-12"></a>  )</span></code></pre></div>
<p><img src="fishStats_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>There, that looks a lot better. We might even think about putting this in a report or an article. If you wanted to save it out as a high-res image in that case, you could use the <code>png()</code>, <code>jpeg()</code>, <code>tiff()</code> or other functions for saving an image. You can check out any of these by running <code>?png</code> in the console to open the help files.</p>
<div id="doing-it-in-the-fsa-package" class="section level3">
<h3>Doing it in the <code>FSA</code> package</h3>
<p>We can make some pretty nice figures by hand, but this can be a lot to learn and not everyone is into it. Likewise we may wish to have a bunch of other standard output with our reproducible figures.</p>
<p>If we want a faster solution, there are a number of <strong>packages</strong> that are maintained in R specifically for fish data. The most comprehensive tool sets is are <code>FSA</code> and the <code>fishmethods</code> packages. Here we will start to play with some of the tools in <code>FSA</code>, following examples from the package documentation, to see how some of the more common fish population assessment tools work.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Load the FSA library</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw">library</span>(FSA)</span></code></pre></div>
<p>The <code>FSA</code> package contains a lot of really cool tools that make life a lot easier. And, you can even get an introductory fisheries statistics book, <a href="http://derekogle.com/IFAR/">fishR</a>, that goes along with it. We will cover some basic applications here, but realize that this package can be used for a whole lot of other stuff, and now includes much of what previously was housed in many different places.</p>
<p>For example, if we wanted to create a length-frequency histogram that shows some of the Gabelhouse length categories, we could do it like this:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Make an l-f histogram that includes Gabelhouse lengths</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw">psdPlot</span>(<span class="op">~</span>tl, <span class="co"># Tell R the name of your length data</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="dt">data =</span> grasscarp, <span class="co"># Tell it the name of the data frame</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="dt">species =</span> <span class="st">&quot;Grass Carp&quot;</span>, <span class="co"># Pass species</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="dt">w =</span> <span class="dv">10</span> <span class="co"># Tell R how wide length-bins are</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>)</span></code></pre></div>
<p><img src="fishStats_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>This is a heck of a lot easier than going through all of that other stuff if what we want is an l-f histogram with all of this info on it. You can, of course still customize what is displayed on the plot using optional arguments when you call <code>psdPlot()</code>. Remember that you can see these arguments, their default values, and their optional values by running <code>?psdPlot</code>.</p>
</div>
</div>
<div id="psd-calculations-and-plotting" class="section level2">
<h2>PSD calculations and plotting</h2>
<p>The plots we used above are neat, but if what we are really after are the numbers or a tic-tac-toe graph for multiple species, then this is only going to give us part of what we want. Luckily, there are other tools for that stuff in the <code>FSA</code> package.</p>
<p>We will demonstrate PSD calculations in R using the <code>FSA</code> package here. Note that these functions are for convenience only, and you could totally do it by hand in R if you were inclined…<strong>ha!</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Calculate PSD for Gabelhouse length categories</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co"># and each of the intervals</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="kw">psdCalc</span>(<span class="op">~</span>tl,</span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="dt">data =</span> grasscarp,</span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="dt">species =</span> <span class="st">&quot;Grass Carp&quot;</span>,</span>
<span id="cb11-6"><a href="#cb11-6"></a>  <span class="dt">digits =</span> <span class="dv">1</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>)</span>
<span id="cb11-8"><a href="#cb11-8"></a>        Estimate <span class="dv">95</span><span class="op">% LCI 95%</span><span class="st"> </span>UCI</span>
<span id="cb11-9"><a href="#cb11-9"></a>PSD<span class="op">-</span>Q       <span class="fl">98.6</span>    <span class="fl">96.8</span>   <span class="fl">100.0</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>PSD<span class="op">-</span>P       <span class="fl">94.5</span>    <span class="fl">91.1</span>    <span class="fl">97.9</span></span>
<span id="cb11-11"><a href="#cb11-11"></a>PSD<span class="op">-</span>M       <span class="fl">70.4</span>    <span class="fl">63.5</span>    <span class="fl">77.3</span></span>
<span id="cb11-12"><a href="#cb11-12"></a>PSD<span class="op">-</span>T       <span class="fl">24.3</span>    <span class="fl">17.9</span>    <span class="fl">30.8</span></span>
<span id="cb11-13"><a href="#cb11-13"></a>PSD S<span class="op">-</span>Q      <span class="fl">1.4</span>     <span class="fl">0.0</span>     <span class="fl">3.2</span></span>
<span id="cb11-14"><a href="#cb11-14"></a>PSD Q<span class="op">-</span>P      <span class="fl">4.1</span>     <span class="fl">1.1</span>     <span class="fl">7.0</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>PSD P<span class="op">-</span>M     <span class="fl">24.1</span>    <span class="fl">17.7</span>    <span class="fl">30.5</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>PSD M<span class="op">-</span>T     <span class="fl">46.1</span>    <span class="fl">38.6</span>    <span class="fl">53.6</span></span></code></pre></div>
<p>If you take a close look at the output, you can see that we not only get point estimates for each of the standard length categories we normally care about, but we also get 95% confidence intervals from those estimates! Very cool…about how long do you think that would have taken you to do from scratch for the first time in Excel?</p>
<div id="tic-tac-toe-plots" class="section level3">
<h3>Tic-tac-toe plots</h3>
<p>The <code>psdCalc()</code> function is really great for calculating PSD for one species, but we are often interested in comparing PSD of predator and prey simultaneously, and graphically, for gauging things like ‘balance’ in fish communities.</p>
<p>So, let’s pretend we have some predator-prey data for which we have already calculated PSD.</p>
<p>We will start by making up (er, simulating) data for predator PSD and prey PSD with 95% Confidence intervals.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Make up mean and 95% CI of PSD for each species</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>prey &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">45</span>, <span class="dv">30</span>, <span class="dv">55</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a>pred &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">10</span>, <span class="dv">37</span>)</span>
<span id="cb12-4"><a href="#cb12-4"></a></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co"># Give names to the values in each of those objects</span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="kw">names</span>(prey) &lt;-<span class="st"> </span><span class="kw">names</span>(pred) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Estimate&quot;</span>, <span class="st">&quot;95% LCI&quot;</span>, <span class="st">&quot;95% UCI&quot;</span>)</span></code></pre></div>
<p>Print predator and prey objects as a dataframe to see what they look like</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">rbind</span>(prey, pred)</span>
<span id="cb13-2"><a href="#cb13-2"></a>     Estimate <span class="dv">95</span><span class="op">% LCI 95%</span><span class="st"> </span>UCI</span>
<span id="cb13-3"><a href="#cb13-3"></a>prey       <span class="dv">45</span>      <span class="dv">30</span>      <span class="dv">55</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>pred       <span class="dv">25</span>      <span class="dv">10</span>      <span class="dv">37</span></span></code></pre></div>
<p>Next, we will make a blank plotting window for our <code>tictactoe()</code> plot.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">tictactoe</span>(</span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="dt">predobj =</span> <span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">70</span>),</span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="dt">preyobj =</span> <span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">70</span>),</span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="dt">predlab =</span> <span class="st">&quot;Predator PSD&quot;</span>,</span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="dt">preylab =</span> <span class="st">&quot;Prey PSD&quot;</span>, <span class="dt">obj.col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="dt">obj.trans =</span> <span class="fl">0.2</span>,</span>
<span id="cb14-7"><a href="#cb14-7"></a>  <span class="dt">bnd.col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb14-8"><a href="#cb14-8"></a>  <span class="dt">bnd.lwd =</span> <span class="dv">1</span>,</span>
<span id="cb14-9"><a href="#cb14-9"></a>  <span class="dt">bnd.lty =</span> <span class="dv">2</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>)</span></code></pre></div>
<p><img src="fishStats_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Now, that gives us a really nice blank plot! What about the data?</p>
<p>Well, we can add the data on our tic-tac-toe plot, of course.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Load the `plotrix` package for the</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co"># `plotCI` function first. You may need</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co"># to install this if it didn&#39;t automatically</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co"># install with `FSA`</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="kw">library</span>(plotrix)</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co"># Plot the PSD and the confidence intervals</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="kw">plotCI</span>(prey[<span class="dv">1</span>], pred[<span class="dv">1</span>],</span>
<span id="cb15-9"><a href="#cb15-9"></a>  <span class="dt">li =</span> prey[<span class="dv">2</span>], <span class="dt">ui =</span> prey[<span class="dv">3</span>],</span>
<span id="cb15-10"><a href="#cb15-10"></a>  <span class="dt">err =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">add =</span> <span class="ot">TRUE</span></span>
<span id="cb15-11"><a href="#cb15-11"></a>)</span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="kw">plotCI</span>(prey[<span class="dv">1</span>], pred[<span class="dv">1</span>],</span>
<span id="cb15-13"><a href="#cb15-13"></a>  <span class="dt">li =</span> pred[<span class="dv">2</span>], <span class="dt">ui =</span> pred[<span class="dv">3</span>],</span>
<span id="cb15-14"><a href="#cb15-14"></a>  <span class="dt">err =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">add =</span> <span class="ot">TRUE</span></span>
<span id="cb15-15"><a href="#cb15-15"></a>)</span></code></pre></div>
<p><img src="fishStats_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Beautiful…Again, think back to the first time you made a tic-tac-toe plot in any other program - about how long did that take again? And could you re-use that plot with a new data set?</p>
</div>
</div>
<div id="estimating-growth-curves" class="section level2">
<h2>Estimating growth curves</h2>
<p>Individual growth, based on length-at-age data can be really useful information when we are developing stock assessments on which we will eventually base fishery management decisions. Growth parameters are central to estimating fish mortality by indirect methods when “empirical” estimates are lacking and often form the basis for yield-per-recruit models that we use to predict effects of catch limits and size limits and develop regulations. There are a number of different tools that we can use to estimate growth curves in R, and many different growth curves that we may wish to fit.</p>
<p>The most commonly used growth curve for length-at-age data is the von Bertalanffy growth model, but there are a whole bunch of others that may be way better depending on the biology of the fish you are studying and any number of other factors. We can estimate these models using either individual length-at-age data, or by using population means. At a basic level we should get virtually identical answers as long as the data are representative. If we have the data, use of individual measurements is generally preferred, and R is a great way to do this.</p>
<p>Let’s look at an example. There are a couple of different ways we can go about fitting grwoth curves in R. All of them require that we pick some kind of growth model, and that we provide starting values for the parameters in that model. The <strong>parameters</strong> are quantities that govern the shape of the growth curve, and that we (usually) need to estimate from the data.</p>
<p>I know, sounds confusing, but the math is actually more straightforward than the funny polynomial lines you may have fit to length-age data in Excel when nobody was looking (don’t do that!!).</p>
<p>We’ll keep working with the <code>grasscarp</code> data for this one.</p>
<p>First, we need to define the von Bertalanffy growth model as an object so R can see it. <strong>Important</strong>: I am using <code>tl</code> and <code>age</code> below because those are the names of the columns in my data that hold length and age data. You will need to change that if you have different names for those columns in your data!</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Define von Bertalanffy growth function</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>vbmod &lt;-<span class="st"> </span>tl <span class="op">~</span><span class="st"> </span>Linf <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>K <span class="op">*</span><span class="st"> </span>(age <span class="op">-</span><span class="st"> </span>t0)))</span></code></pre></div>
<p>Now, we can pass this on to a non-linear optimizer, just like you might do with the “Solver” add-in for Excel. But first, we need to come up with some starting values. Without any prior knowledge of the study population this can be tough. But, we can get some starting values for our parameters (<code>Linf</code>, <code>K</code>, and <code>t0</code>) using the <code>FSA</code> package.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Get starting values for each of your</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co"># parameters using the `vbStarts` function</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="co"># from `FSA`</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>starts &lt;-<span class="st"> </span><span class="kw">vbStarts</span>(<span class="dt">formula =</span> tl <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> grasscarp)</span></code></pre></div>
<p>Now, we have a <code>list</code> of starting values that we can use to start estimating the growth function.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Have a look at the starting values for</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co"># the parameters.</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>starts</span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="op">$</span>Linf</span>
<span id="cb18-5"><a href="#cb18-5"></a>[<span class="dv">1</span>] <span class="fl">1082.361</span></span>
<span id="cb18-6"><a href="#cb18-6"></a></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="op">$</span>K</span>
<span id="cb18-8"><a href="#cb18-8"></a>[<span class="dv">1</span>] <span class="fl">0.3282342</span></span>
<span id="cb18-9"><a href="#cb18-9"></a></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="op">$</span>t0</span>
<span id="cb18-11"><a href="#cb18-11"></a>[<span class="dv">1</span>] <span class="fl">-0.4778118</span></span></code></pre></div>
<p>With these in hand, we can finally estimate the parameters for the von Bertalanffy growth function for these fishies:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Fit the von Bertalanffy growth function using</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="co"># nonlinear least squares (nls) optimization</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>mymod &lt;-<span class="st"> </span><span class="kw">nls</span>(vbmod, <span class="dt">data =</span> grasscarp, <span class="dt">start =</span> starts)</span></code></pre></div>
<p>And, at long last we can have a look at the parameter estimates like this:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Show model summary</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="kw">summary</span>(mymod)</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a>Formula<span class="op">:</span><span class="st"> </span>tl <span class="op">~</span><span class="st"> </span>Linf <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>K <span class="op">*</span><span class="st"> </span>(age <span class="op">-</span><span class="st"> </span>t0)))</span>
<span id="cb20-5"><a href="#cb20-5"></a></span>
<span id="cb20-6"><a href="#cb20-6"></a>Parameters<span class="op">:</span></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="st">       </span>Estimate Std. Error t value <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>t<span class="op">|</span>)    </span>
<span id="cb20-8"><a href="#cb20-8"></a>Linf <span class="fl">1132.24913</span>   <span class="fl">13.35187</span>  <span class="fl">84.801</span>  <span class="op">&lt;</span><span class="st"> </span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb20-9"><a href="#cb20-9"></a>K       <span class="fl">0.20361</span>    <span class="fl">0.01869</span>  <span class="fl">10.892</span>  <span class="op">&lt;</span><span class="st"> </span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb20-10"><a href="#cb20-10"></a>t0     <span class="fl">-2.20748</span>    <span class="fl">0.40660</span>  <span class="fl">-5.429</span> <span class="fl">9.65e-08</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="op">---</span></span>
<span id="cb20-12"><a href="#cb20-12"></a>Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb20-13"><a href="#cb20-13"></a></span>
<span id="cb20-14"><a href="#cb20-14"></a>Residual standard error<span class="op">:</span><span class="st"> </span><span class="fl">91.56</span> on <span class="dv">416</span> degrees of freedom</span>
<span id="cb20-15"><a href="#cb20-15"></a></span>
<span id="cb20-16"><a href="#cb20-16"></a>Number of iterations to convergence<span class="op">:</span><span class="st"> </span><span class="dv">4</span> </span>
<span id="cb20-17"><a href="#cb20-17"></a>Achieved convergence tolerance<span class="op">:</span><span class="st"> </span><span class="fl">3.834e-06</span></span></code></pre></div>
<p>We can predict mean length at age for each observation in our data set or from new data. For ease of plotting, we’ll predict <code>tl</code> from observed <code>age</code> in the <code>grasscarp</code> data using the default <code>predict()</code> function:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>pred &lt;-<span class="st"> </span><span class="kw">predict</span>(mymod)</span></code></pre></div>
<p>But, we are scientists, so we’d also like to get some confidence intervals for those predictions. At the time of writing, this still hasn’t been implemented but we can use a boot-strap approach to estimate mean length at age and confidence intervals for now. We’ll add a couple steps to follow the usual workflow from <code>FSA</code> here using the same <code>typical</code> von Bertalanffy growth model we defined above in <code>vbmod</code>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Get the desired growth function from a list</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="co"># of those that are available in FSA</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>vbO &lt;-<span class="st"> </span><span class="kw">vbFuns</span>(<span class="st">&quot;typical&quot;</span>)</span>
<span id="cb22-4"><a href="#cb22-4"></a></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co"># Fit the model to the data using nls, like we did before</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>vb_fit &lt;-<span class="st"> </span><span class="kw">nls</span>(tl<span class="op">~</span><span class="kw">vbO</span>(age,Linf,K, t0), <span class="dt">data=</span>grasscarp, <span class="dt">start=</span>starts)</span>
<span id="cb22-7"><a href="#cb22-7"></a></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="co"># Now, bootstrap the model fitting process</span></span>
<span id="cb22-9"><a href="#cb22-9"></a>boot_fit &lt;-<span class="st"> </span><span class="kw">nlsBoot</span>(vb_fit)</span>
<span id="cb22-10"><a href="#cb22-10"></a></span>
<span id="cb22-11"><a href="#cb22-11"></a><span class="co"># Predict length at age from the model</span></span>
<span id="cb22-12"><a href="#cb22-12"></a><span class="co"># t is age. Here, we tell R to predict</span></span>
<span id="cb22-13"><a href="#cb22-13"></a><span class="co"># length at each unique age in our original</span></span>
<span id="cb22-14"><a href="#cb22-14"></a><span class="co"># data, and calculate some bootstrapped confidence</span></span>
<span id="cb22-15"><a href="#cb22-15"></a><span class="co"># intervals</span></span>
<span id="cb22-16"><a href="#cb22-16"></a>boot_preds &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb22-17"><a href="#cb22-17"></a>  <span class="kw">predict</span>(boot_fit, vbO, <span class="dt">t =</span> <span class="kw">sort</span>(<span class="kw">unique</span>(grasscarp<span class="op">$</span>age))))</span></code></pre></div>
<p>Have a look at <code>boot_preds</code> in the data viewer if you want to see what this looks like.</p>
<p>We’ll want to change the names to make things more convenient here. I am going to use the standard R names for predicted mean (<code>fit</code>), lower 95% (<code>lwr</code>), and upper 95% (<code>upr</code>) that are output from the default <code>predict()</code> function so I don’t have to change the plotting code that I’m about to copy and paste for the next two sections!</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">names</span>(boot_preds) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;fit&quot;</span>, <span class="st">&quot;lwr&quot;</span>, <span class="st">&quot;upr&quot;</span>)</span></code></pre></div>
<p>Go ahead and merge the boot-strapped predictions and confidence intervals back into our original data set, again just for convenience in the plotting routine that follows</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>grasscarp_preds &lt;-<span class="st"> </span><span class="kw">merge</span>(grasscarp, boot_preds, <span class="dt">by =</span> <span class="st">&quot;age&quot;</span>)</span></code></pre></div>
<p>And finally, we can plot our predictions against the raw data. Here, we make use of the <code>alpha</code> argument in different geometries so we can see density of raw data points and the confidence bands around our predictions all at once.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">ggplot</span>(grasscarp_preds, <span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> tl)) <span class="op">+</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.1</span>, <span class="dt">alpha =</span> <span class="fl">0.15</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> fit)) <span class="op">+</span></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(</span>
<span id="cb25-5"><a href="#cb25-5"></a>    <span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">ymin =</span> lwr, <span class="dt">ymax =</span> upr, <span class="dt">color =</span> <span class="ot">NULL</span>), <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Age (years)&quot;</span>) <span class="op">+</span></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total length (mm)&quot;</span>) <span class="op">+</span></span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="fishStats_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Sweet, sweet carpiness.</p>
</div>
<div id="length-weight-regression" class="section level2">
<h2>Length-weight regression</h2>
<p>Compared to non-linear regression, linear regression is really straightforward in R. Let’s demonstrate quickly with the log10(weight)-log10(length) relationship with which most of you are familiar.</p>
<p>Start by transforming, or <code>mutate()</code>-ing the length and mass data:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>lw_data &lt;-<span class="st"> </span>grasscarp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(kg)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">loglength =</span> <span class="kw">log10</span>(tl), <span class="dt">logkg =</span> <span class="kw">log10</span>(kg))</span></code></pre></div>
<p>Now we can fit a linear regression using the <code>lm()</code> function in R:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>lw_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(logkg<span class="op">~</span>loglength, <span class="dt">data =</span> lw_data)</span></code></pre></div>
<p>We can look at the output of <code>summary()</code> for the model to get the coefficients, estimated standard errors, and R<sup>2</sup> for the fit:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">summary</span>(lw_mod)</span>
<span id="cb28-2"><a href="#cb28-2"></a></span>
<span id="cb28-3"><a href="#cb28-3"></a>Call<span class="op">:</span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="kw">lm</span>(<span class="dt">formula =</span> logkg <span class="op">~</span><span class="st"> </span>loglength, <span class="dt">data =</span> lw_data)</span>
<span id="cb28-5"><a href="#cb28-5"></a></span>
<span id="cb28-6"><a href="#cb28-6"></a>Residuals<span class="op">:</span></span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="st">     </span>Min       1Q   Median       3Q      Max </span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="fl">-0.98443</span> <span class="fl">-0.04438</span> <span class="fl">-0.00431</span>  <span class="fl">0.04574</span>  <span class="fl">0.24221</span> </span>
<span id="cb28-9"><a href="#cb28-9"></a></span>
<span id="cb28-10"><a href="#cb28-10"></a>Coefficients<span class="op">:</span></span>
<span id="cb28-11"><a href="#cb28-11"></a><span class="st">            </span>Estimate Std. Error t value <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>t<span class="op">|</span>)    </span>
<span id="cb28-12"><a href="#cb28-12"></a>(Intercept) <span class="fl">-7.04259</span>    <span class="fl">0.17208</span>  <span class="fl">-40.93</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb28-13"><a href="#cb28-13"></a>loglength    <span class="fl">2.72395</span>    <span class="fl">0.05774</span>   <span class="fl">47.17</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb28-14"><a href="#cb28-14"></a><span class="op">---</span></span>
<span id="cb28-15"><a href="#cb28-15"></a>Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb28-16"><a href="#cb28-16"></a></span>
<span id="cb28-17"><a href="#cb28-17"></a>Residual standard error<span class="op">:</span><span class="st"> </span><span class="fl">0.08762</span> on <span class="dv">347</span> degrees of freedom</span>
<span id="cb28-18"><a href="#cb28-18"></a>Multiple R<span class="op">-</span>squared<span class="op">:</span><span class="st">  </span><span class="fl">0.8651</span>,    Adjusted R<span class="op">-</span>squared<span class="op">:</span><span class="st">  </span><span class="fl">0.8647</span> </span>
<span id="cb28-19"><a href="#cb28-19"></a>F<span class="op">-</span>statistic<span class="op">:</span><span class="st">  </span><span class="dv">2226</span> on <span class="dv">1</span> and <span class="dv">347</span> DF,  p<span class="op">-</span>value<span class="op">:</span><span class="st"> </span><span class="er">&lt;</span><span class="st"> </span><span class="fl">2.2e-16</span></span></code></pre></div>
<p>And, it is super easy to make log-scale predictions for comparison against our raw data:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>log_preds &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">predict</span>(lw_mod, <span class="dt">interval =</span> <span class="st">&quot;confidence&quot;</span>))</span></code></pre></div>
<p>We can even get these back on the real scale:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>preds &lt;-<span class="st"> </span><span class="kw">apply</span>(<span class="dt">X =</span> log_preds, <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">FUN =</span> <span class="cf">function</span>(x){<span class="dv">10</span><span class="op">^</span>x})</span></code></pre></div>
<p>Add that back to the raw data:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>lw_preds &lt;-<span class="st"> </span><span class="kw">data.frame</span>(lw_data, preds)</span></code></pre></div>
<p>And now we can plot our predictions</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">ggplot</span>(lw_preds, <span class="kw">aes</span>(<span class="dt">x =</span> tl, <span class="dt">y =</span> kg)) <span class="op">+</span></span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.1</span>, <span class="dt">alpha =</span> <span class="fl">0.15</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> fit)) <span class="op">+</span></span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(</span>
<span id="cb32-5"><a href="#cb32-5"></a>    <span class="kw">aes</span>(<span class="dt">x =</span> tl, <span class="dt">ymin =</span> lwr, <span class="dt">ymax =</span> upr, <span class="dt">color =</span> <span class="ot">NULL</span>), <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Age (years)&quot;</span>) <span class="op">+</span></span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total length (mm)&quot;</span>) <span class="op">+</span></span>
<span id="cb32-8"><a href="#cb32-8"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="fishStats_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Wow, that is way to convenient. Did you notice that the only thing I changed in the plotting code was the names of the data (<code>x</code> and <code>y</code>)?</p>
</div>
<div id="closing-remarks" class="section level2">
<h2>Closing remarks</h2>
<p>Okay, if that’s not all we have time for we can poke around with some other stuff when we meet. But, this should at least demystify a little bit of R for you, and hopefully it gives you the chance to get into some of this on your own. When in doubt, remember that good information is still available in those paper objects called books, but Google is really your BFF when it comes to getting help with R.</p>
<p><br></p>
</div>
</div>

<!DOCTYPE html>

<br>

<hr>

<p style="color:gray">This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/legalcode">Creative Commons Attribution 4.0 International License.</a></p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
